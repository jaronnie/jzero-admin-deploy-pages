import{q as J,e as L,f as oe,b as re,_ as ue,c as pe,u as ie,g as me,r as de,s as ce,j as _e,N as ge,k as fe,l as ve}from"./business-Cmh1pbKO.js";import{d as I,aA as z,aB as H,a as Q,$ as l,p as he,r as be,aC as ye,o as x,c as B,w as n,f as a,g as T,t as M,h as e,b as A,a2 as V,a3 as q,v as X,aE as Y,B as F,b5 as ke,b6 as Ne,b7 as K,J as Z,A as we,aJ as O,a4 as W,aK as xe}from"./index-FJqBwoy_.js";import{u as ee,a as ae,_ as Re,b as le}from"./form-xPyKlAZw.js";import{_ as ne}from"./Space-dhFrRzkT.js";import{_ as Se,a as Ge,b as Ue,c as Pe}from"./round-refresh-CL7IJmva.js";import{a as De}from"./Grid-Dx_bLpLa.js";const Ee=I({name:"UserOperateDrawer",__name:"user-operate-drawer",props:z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:z(["submitted"],["update:visible"]),setup(b,{emit:P}){const y=b,N=P,f=H(b,"visible"),{formRef:R,validate:m,restoreValidation:S}=ee(),{defaultRequiredRule:G}=ae(),w=Q(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[y.operateType]),o=he(i());function i(){return{username:"",userGender:null,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:null}}const k={username:G,status:G},c=be([]);async function U(){const{error:v,data:u}=await oe();if(!v){const h=u.map(s=>({label:s.roleName,value:s.roleCode})),d=o.userRoles.map(s=>({label:s,value:s}));c.value=[...d,...h]}}function D(){Object.assign(o,i()),y.operateType==="edit"&&y.rowData&&Object.assign(o,y.rowData)}function _(){f.value=!1}async function E(){var v;await m(),(v=window.$message)==null||v.success(l("common.updateSuccess")),_(),N("submitted")}return ye(f,()=>{f.value&&(D(),S(),U())}),(v,u)=>{const h=X,d=Re,s=ue,p=re,t=Y,j=le,C=F,g=ne,te=ke,se=Ne;return x(),B(se,{show:f.value,"onUpdate:show":u[7]||(u[7]=r=>f.value=r),"display-directive":"show",width:360},{default:n(()=>[a(te,{title:w.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[a(g,{size:16},{default:n(()=>[a(C,{onClick:_},{default:n(()=>[T(M(e(l)("common.cancel")),1)]),_:1}),a(C,{type:"primary",onClick:E},{default:n(()=>[T(M(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[a(j,{ref_key:"formRef",ref:R,model:o,rules:k},{default:n(()=>[a(d,{label:e(l)("page.manage.user.username"),path:"username"},{default:n(()=>[a(h,{value:o.username,"onUpdate:value":u[0]||(u[0]=r=>o.username=r),placeholder:e(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userGender"),path:"userGender"},{default:n(()=>[a(p,{value:o.userGender,"onUpdate:value":u[1]||(u[1]=r=>o.userGender=r)},{default:n(()=>[(x(!0),A(q,null,V(e(J),r=>(x(),B(s,{key:r.value,value:r.value,label:e(l)(r.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.nickName"),path:"nickName"},{default:n(()=>[a(h,{value:o.nickName,"onUpdate:value":u[2]||(u[2]=r=>o.nickName=r),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userPhone"),path:"userPhone"},{default:n(()=>[a(h,{value:o.userPhone,"onUpdate:value":u[3]||(u[3]=r=>o.userPhone=r),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userEmail"),path:"email"},{default:n(()=>[a(h,{value:o.userEmail,"onUpdate:value":u[4]||(u[4]=r=>o.userEmail=r),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userStatus"),path:"status"},{default:n(()=>[a(p,{value:o.status,"onUpdate:value":u[5]||(u[5]=r=>o.status=r)},{default:n(()=>[(x(!0),A(q,null,V(e(L),r=>(x(),B(s,{key:r.value,value:r.value,label:e(l)(r.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userRole"),path:"roles"},{default:n(()=>[a(t,{value:o.userRoles,"onUpdate:value":u[6]||(u[6]=r=>o.userRoles=r),multiple:"",options:c.value,placeholder:e(l)("page.manage.user.form.userRole")},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ce=I({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:z(["reset","search"],["update:model"]),setup(b,{emit:P}){const y=P,{formRef:N,validate:f,restoreValidation:R}=ee(),m=H(b,"model"),S=Q(()=>{const{patternRules:o}=ae();return{userEmail:o.email,userPhone:o.phone}});async function G(){await R(),y("reset")}async function w(){await f(),y("search")}return(o,i)=>{const k=X,c=pe,U=Y,D=Se,_=F,E=Ge,v=ne,u=De,h=le,d=Ue,s=Pe,p=Z;return x(),B(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(s,null,{default:n(()=>[a(d,{title:e(l)("common.search"),name:"user-search"},{default:n(()=>[a(h,{ref_key:"formRef",ref:N,model:m.value,rules:S.value,"label-placement":"left","label-width":80},{default:n(()=>[a(u,{responsive:"screen","item-responsive":""},{default:n(()=>[a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:n(()=>[a(k,{value:m.value.username,"onUpdate:value":i[0]||(i[0]=t=>m.value.username=t),placeholder:e(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:n(()=>[a(U,{value:m.value.userGender,"onUpdate:value":i[1]||(i[1]=t=>m.value.userGender=t),placeholder:e(l)("page.manage.user.form.userGender"),options:e(K)(e(J)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:n(()=>[a(k,{value:m.value.nickName,"onUpdate:value":i[2]||(i[2]=t=>m.value.nickName=t),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:n(()=>[a(k,{value:m.value.userPhone,"onUpdate:value":i[3]||(i[3]=t=>m.value.userPhone=t),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:n(()=>[a(k,{value:m.value.userEmail,"onUpdate:value":i[4]||(i[4]=t=>m.value.userEmail=t),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userStatus"),path:"userStatus",class:"pr-24px"},{default:n(()=>[a(U,{value:m.value.status,"onUpdate:value":i[5]||(i[5]=t=>m.value.status=t),placeholder:e(l)("page.manage.user.form.userStatus"),options:e(K)(e(L)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(c,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[a(v,{class:"w-full",justify:"end"},{default:n(()=>[a(_,{onClick:G},{icon:n(()=>[a(D,{class:"text-icon"})]),default:n(()=>[T(" "+M(e(l)("common.reset")),1)]),_:1}),a(_,{type:"primary",ghost:"",onClick:w},{icon:n(()=>[a(E,{class:"text-icon"})]),default:n(()=>[T(" "+M(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function $(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!xe(b)}const ze=I({name:"manage_user",__name:"index",setup(b){const P=we(),{columns:y,columnChecks:N,data:f,getData:R,getDataByPage:m,loading:S,mobilePagination:G,searchParams:w,resetSearchParams:o}=ie({apiFn:de,showTotal:!0,apiParams:{current:1,size:10,status:null,username:null,userGender:null,nickName:null,userPhone:null,userEmail:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:l("common.index"),align:"center",width:64},{key:"username",title:l("page.manage.user.username"),align:"center",minWidth:100},{key:"userGender",title:l("page.manage.user.userGender"),align:"center",width:100,render:s=>{if(s.userGender===null)return null;const p={1:"primary",2:"error"},t=l(ce[s.userGender]);return a(W,{type:p[s.userGender]},$(t)?t:{default:()=>[t]})}},{key:"nickName",title:l("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:l("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:l("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"status",title:l("page.manage.user.userStatus"),align:"center",width:100,render:s=>{if(s.status===null)return null;const p={1:"success",2:"warning"},t=l(_e[s.status]);return a(W,{type:p[s.status]},$(t)?t:{default:()=>[t]})}},{key:"operate",title:l("common.operate"),align:"center",width:130,render:s=>{let p;return a("div",{class:"flex-center gap-8px"},[a(F,{type:"primary",ghost:!0,size:"small",onClick:()=>d(s.id)},$(p=l("common.edit"))?p:{default:()=>[p]}),a(ge,{onPositiveClick:()=>h(s.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let t;return a(F,{type:"error",ghost:!0,size:"small"},$(t=l("common.delete"))?t:{default:()=>[t]})}})])}}]}),{drawerVisible:i,operateType:k,editingData:c,handleAdd:U,handleEdit:D,checkedRowKeys:_,onBatchDeleted:E,onDeleted:v}=me(f,R);async function u(){console.log(_.value),E()}function h(s){console.log(s),v()}function d(s){D(s)}return(s,p)=>{const t=fe,j=ve,C=Z;return x(),A("div",Oe,[a(Ce,{model:e(w),"onUpdate:model":p[0]||(p[0]=g=>O(w)?w.value=g:null),onReset:e(o),onSearch:e(m)},null,8,["model","onReset","onSearch"]),a(C,{title:e(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(t,{columns:e(N),"onUpdate:columns":p[1]||(p[1]=g=>O(N)?N.value=g:null),"disabled-delete":e(_).length===0,loading:e(S),onAdd:e(U),onDelete:u,onRefresh:e(R)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:n(()=>[a(j,{"checked-row-keys":e(_),"onUpdate:checkedRowKeys":p[2]||(p[2]=g=>O(_)?_.value=g:null),columns:e(y),data:e(f),size:"small","flex-height":!e(P).isMobile,"scroll-x":962,loading:e(S),remote:"","row-key":g=>g.id,pagination:e(G),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Ee,{visible:e(i),"onUpdate:visible":p[3]||(p[3]=g=>O(i)?i.value=g:null),"operate-type":e(k),"row-data":e(c),onSubmitted:e(m)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{ze as default};
