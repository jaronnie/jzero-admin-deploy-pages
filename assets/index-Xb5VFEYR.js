import{p as H,e as J,G as ie,q as pe,E as me,b as de,_ as ce,c as _e,u as ge,f as fe,r as ve,s as he,i as be,N as ye,j as we,k as ke}from"./business-zKE6o0Mm.js";import{d as A,aB as j,aC as Q,y as Ne,a as X,$ as l,p as Re,r as xe,aD as Ge,o as w,c as T,w as o,f as a,g as M,t as F,h as e,b as z,a3 as V,a4 as q,aE as Se,v as Y,aF as Z,aH as Ue,B as L,aI as Pe,b8 as K,J as ee,A as Ee,aK as $,a5 as W,aL as De}from"./index-Cvi-sYie.js";import{u as ae,a as le,_ as Ce,b as ne}from"./form-D5_31G_i.js";import{_ as se}from"./Space-BsCYa8iE.js";import{_ as Te,a as Oe,b as $e,c as Be}from"./round-refresh-Cvr4Isq7.js";import{a as Me}from"./Grid-Cu3XDYzp.js";const Fe=A({name:"UserOperateDrawer",__name:"user-operate-modal",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(v,{emit:U}){const d=v,h=U,g=Q(v,"visible"),{formRef:G,validate:i,restoreValidation:S}=ae(),{defaultRequiredRule:k}=le(),{loading:N,startLoading:b,endLoading:p}=Ne(),y=X(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[d.operateType]),n=Re(R());function R(){return{username:"",password:"",userGender:null,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:null}}const P={username:k,status:k,password:k},c=xe([]);async function E(){const{error:f,data:s}=await ie();if(!f){const r=s.map(m=>({label:m.roleName,value:m.roleCode})),t=n.userRoles.map(m=>({label:m,value:m}));c.value=[...t,...r]}}function D(){Object.assign(n,R()),d.operateType==="edit"&&d.rowData&&Object.assign(n,d.rowData)}function x(){g.value=!1}async function C(){var f,s,r;if(d.operateType==="add"){await i();const t={username:n.username,userGender:n.userGender,nickName:n.nickName,userPhone:n.userPhone,userEmail:n.userEmail,userRoles:n.userRoles,password:n.password,status:n.status};b();const{error:m}=await pe(t);m||((f=window.$message)==null||f.success(l("common.addSuccess")),x(),h("submitted")),p()}else if(d.operateType==="edit"){await i();const t={id:(s=d.rowData)==null?void 0:s.id,username:n.username,userGender:n.userGender,nickName:n.nickName,userPhone:n.userPhone,userEmail:n.userEmail,userRoles:n.userRoles,status:n.status};b();const{error:m}=await me(t);m||((r=window.$message)==null||r.success(l("common.updateSuccess")),x(),h("submitted")),p()}}return Ge(g,()=>{g.value&&(D(),S(),E())}),(f,s)=>{const r=Y,t=Ce,m=ce,O=de,_=Z,te=ne,oe=Ue,I=L,re=se,ue=Pe;return w(),T(ue,{show:g.value,"onUpdate:show":s[8]||(s[8]=u=>g.value=u),title:y.value,preset:"card",class:"w-800px"},{footer:o(()=>[a(re,{size:16,justify:"end"},{default:o(()=>[a(I,{onClick:x},{default:o(()=>[M(F(e(l)("common.cancel")),1)]),_:1}),a(I,{type:"primary",loding:e(N),onClick:C},{default:o(()=>[M(F(e(l)("common.confirm")),1)]),_:1},8,["loding"])]),_:1})]),default:o(()=>[a(oe,{class:"h-408px pr-20px"},{default:o(()=>[a(te,{ref_key:"formRef",ref:G,model:n,rules:P,"label-placement":"left","label-width":100},{default:o(()=>[a(t,{label:e(l)("page.manage.user.username"),path:"username"},{default:o(()=>[a(r,{value:n.username,"onUpdate:value":s[0]||(s[0]=u=>n.username=u),placeholder:e(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(t,{label:e(l)("page.manage.user.userGender"),path:"userGender"},{default:o(()=>[a(O,{value:n.userGender,"onUpdate:value":s[1]||(s[1]=u=>n.userGender=u)},{default:o(()=>[(w(!0),z(q,null,V(e(H),u=>(w(),T(m,{key:u.value,value:u.value,label:e(l)(u.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(t,{label:e(l)("page.manage.user.nickName"),path:"nickName"},{default:o(()=>[a(r,{value:n.nickName,"onUpdate:value":s[2]||(s[2]=u=>n.nickName=u),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(t,{label:e(l)("page.manage.user.userPhone"),path:"userPhone"},{default:o(()=>[a(r,{value:n.userPhone,"onUpdate:value":s[3]||(s[3]=u=>n.userPhone=u),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(t,{label:e(l)("page.manage.user.userEmail"),path:"email"},{default:o(()=>[a(r,{value:n.userEmail,"onUpdate:value":s[4]||(s[4]=u=>n.userEmail=u),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(t,{label:e(l)("page.manage.user.userStatus"),path:"status"},{default:o(()=>[a(O,{value:n.status,"onUpdate:value":s[5]||(s[5]=u=>n.status=u)},{default:o(()=>[(w(!0),z(q,null,V(e(J),u=>(w(),T(m,{key:u.value,value:u.value,label:e(l)(u.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(t,{label:e(l)("page.manage.user.userRole"),path:"roles"},{default:o(()=>[a(_,{value:n.userRoles,"onUpdate:value":s[6]||(s[6]=u=>n.userRoles=u),multiple:"",options:c.value,placeholder:e(l)("page.manage.user.form.userRole")},null,8,["value","options","placeholder"])]),_:1},8,["label"]),d.operateType==="add"?(w(),T(t,{key:0,label:e(l)("page.manage.user.password"),path:"password"},{default:o(()=>[a(r,{value:n.password,"onUpdate:value":s[7]||(s[7]=u=>n.password=u),placeholder:e(l)("page.manage.user.form.password")},null,8,["value","placeholder"])]),_:1},8,["label"])):Se("",!0)]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Le=A({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(v,{emit:U}){const d=U,{formRef:h,validate:g,restoreValidation:G}=ae(),i=Q(v,"model"),S=X(()=>{const{patternRules:b}=le();return{userEmail:b.email,userPhone:b.phone}});async function k(){await G(),d("reset")}async function N(){await g(),d("search")}return(b,p)=>{const y=Y,n=_e,R=Z,P=Te,c=L,E=Oe,D=se,x=Me,C=ne,f=$e,s=Be,r=ee;return w(),T(r,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(s,null,{default:o(()=>[a(f,{title:e(l)("common.search"),name:"user-search"},{default:o(()=>[a(C,{ref_key:"formRef",ref:h,model:i.value,rules:S.value,"label-placement":"left","label-width":80},{default:o(()=>[a(x,{responsive:"screen","item-responsive":""},{default:o(()=>[a(n,{span:"24 s:12 m:6",label:e(l)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:o(()=>[a(y,{value:i.value.username,"onUpdate:value":p[0]||(p[0]=t=>i.value.username=t),placeholder:e(l)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:o(()=>[a(R,{value:i.value.userGender,"onUpdate:value":p[1]||(p[1]=t=>i.value.userGender=t),placeholder:e(l)("page.manage.user.form.userGender"),options:e(K)(e(H)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(n,{span:"24 s:12 m:6",label:e(l)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:o(()=>[a(y,{value:i.value.nickName,"onUpdate:value":p[2]||(p[2]=t=>i.value.nickName=t),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:o(()=>[a(y,{value:i.value.userPhone,"onUpdate:value":p[3]||(p[3]=t=>i.value.userPhone=t),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:o(()=>[a(y,{value:i.value.userEmail,"onUpdate:value":p[4]||(p[4]=t=>i.value.userEmail=t),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userStatus"),path:"userStatus",class:"pr-24px"},{default:o(()=>[a(R,{value:i.value.status,"onUpdate:value":p[5]||(p[5]=t=>i.value.status=t),placeholder:e(l)("page.manage.user.form.userStatus"),options:e(K)(e(J)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(n,{span:"24 m:12",class:"pr-24px"},{default:o(()=>[a(D,{class:"w-full",justify:"end"},{default:o(()=>[a(c,{onClick:k},{icon:o(()=>[a(P,{class:"text-icon"})]),default:o(()=>[M(" "+F(e(l)("common.reset")),1)]),_:1}),a(c,{type:"primary",ghost:"",onClick:N},{icon:o(()=>[a(E,{class:"text-icon"})]),default:o(()=>[M(" "+F(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),je={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!De(v)}const We=A({name:"manage_user",__name:"index",setup(v){const U=Ee(),{columns:d,columnChecks:h,data:g,getData:G,getDataByPage:i,loading:S,mobilePagination:k,searchParams:N,resetSearchParams:b}=ge({apiFn:ve,showTotal:!0,apiParams:{current:1,size:10,status:null,username:null,userGender:null,nickName:null,userPhone:null,userEmail:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:l("common.index"),align:"center",width:64},{key:"username",title:l("page.manage.user.username"),align:"center",minWidth:100},{key:"userGender",title:l("page.manage.user.userGender"),align:"center",width:100,render:s=>{if(s.userGender===null)return null;const r={1:"primary",2:"error"},t=l(he[s.userGender]);return a(W,{type:r[s.userGender]},B(t)?t:{default:()=>[t]})}},{key:"nickName",title:l("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:l("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:l("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"status",title:l("page.manage.user.userStatus"),align:"center",width:100,render:s=>{if(s.status===null)return null;const r={1:"success",2:"warning"},t=l(be[s.status]);return a(W,{type:r[s.status]},B(t)?t:{default:()=>[t]})}},{key:"operate",title:l("common.operate"),align:"center",width:130,render:s=>{let r;return a("div",{class:"flex-center gap-8px"},[a(L,{type:"primary",ghost:!0,size:"small",onClick:()=>f(s.id)},B(r=l("common.edit"))?r:{default:()=>[r]}),a(ye,{onPositiveClick:()=>C(s.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let t;return a(L,{type:"error",ghost:!0,size:"small"},B(t=l("common.delete"))?t:{default:()=>[t]})}})])}}]}),{drawerVisible:p,operateType:y,editingData:n,handleAdd:R,handleEdit:P,checkedRowKeys:c,onBatchDeleted:E,onDeleted:D}=fe(g,G);async function x(){console.log(c.value),E()}function C(s){console.log(s),D()}function f(s){P(s)}return(s,r)=>{const t=we,m=ke,O=ee;return w(),z("div",je,[a(Le,{model:e(N),"onUpdate:model":r[0]||(r[0]=_=>$(N)?N.value=_:null),onReset:e(b),onSearch:e(i)},null,8,["model","onReset","onSearch"]),a(O,{title:e(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[a(t,{columns:e(h),"onUpdate:columns":r[1]||(r[1]=_=>$(h)?h.value=_:null),"disabled-delete":e(c).length===0,loading:e(S),onAdd:e(R),onDelete:x,onRefresh:e(G)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:o(()=>[a(m,{"checked-row-keys":e(c),"onUpdate:checkedRowKeys":r[2]||(r[2]=_=>$(c)?c.value=_:null),columns:e(d),data:e(g),size:"small","flex-height":!e(U).isMobile,"scroll-x":962,loading:e(S),remote:"","row-key":_=>_.id,pagination:e(k),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Fe,{visible:e(p),"onUpdate:visible":r[3]||(r[3]=_=>$(p)?p.value=_:null),"operate-type":e(y),"row-data":e(n),onSubmitted:e(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{We as default};
