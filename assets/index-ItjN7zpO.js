import{p as J,e as Q,G as pe,q as de,E as me,b as ce,_ as _e,c as ge,u as fe,f as ve,r as be,s as he,i as ye,N as we,D as V,j as ke,k as Ne}from"./business-BsADCgui.js";import{d as z,aB as j,aC as X,y as Re,a as Y,$ as n,p as xe,r as Ue,aD as Ge,o as w,c as T,w as o,f as a,g as M,t as F,h as e,b as I,a3 as q,a4 as K,aE as Se,v as Z,aF as ee,aH as Pe,B as L,aI as Ee,b8 as W,J as ae,A as De,aK as $,a5 as H,aL as Ce}from"./index-DuNTnP3p.js";import{u as ne,a as le,_ as Te,b as se}from"./form-D1NVtCPA.js";import{_ as te}from"./Space-NQc-JYrW.js";import{_ as Oe,a as $e,b as Be,c as Me}from"./round-refresh-JPm9nghL.js";import{a as Fe}from"./Grid-DzF9ZSR4.js";const Le=z({name:"UserOperateDrawer",__name:"user-operate-modal",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(v,{emit:S}){const d=v,b=S,g=X(v,"visible"),{formRef:U,validate:i,restoreValidation:G}=ne(),{defaultRequiredRule:k}=le(),{loading:N,startLoading:h,endLoading:p}=Re(),y=Y(()=>({add:n("page.manage.user.addUser"),edit:n("page.manage.user.editUser")})[d.operateType]),l=xe(R());function R(){return{username:"",password:"",userGender:null,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:null}}const P={username:k,status:k,password:k},c=Ue([]);async function E(){const{error:f,data:t}=await pe();if(!f){const r=t.map(m=>({label:m.roleName,value:m.roleCode})),s=l.userRoles.map(m=>({label:m,value:m}));c.value=[...s,...r]}}function D(){Object.assign(l,R()),d.operateType==="edit"&&d.rowData&&Object.assign(l,d.rowData)}function x(){g.value=!1}async function C(){var f,t,r;if(d.operateType==="add"){await i();const s={username:l.username,userGender:l.userGender,nickName:l.nickName,userPhone:l.userPhone,userEmail:l.userEmail,userRoles:l.userRoles,password:l.password,status:l.status};h();const{error:m}=await de(s);m||((f=window.$message)==null||f.success(n("common.addSuccess")),x(),b("submitted")),p()}else if(d.operateType==="edit"){await i();const s={id:(t=d.rowData)==null?void 0:t.id,username:l.username,userGender:l.userGender,nickName:l.nickName,userPhone:l.userPhone,userEmail:l.userEmail,userRoles:l.userRoles,status:l.status};h();const{error:m}=await me(s);m||((r=window.$message)==null||r.success(n("common.updateSuccess")),x(),b("submitted")),p()}}return Ge(g,()=>{g.value&&(D(),G(),E())}),(f,t)=>{const r=Z,s=Te,m=_e,O=ce,_=ee,oe=se,re=Pe,A=L,ue=te,ie=Ee;return w(),T(ie,{show:g.value,"onUpdate:show":t[8]||(t[8]=u=>g.value=u),title:y.value,preset:"card",class:"w-800px"},{footer:o(()=>[a(ue,{size:16,justify:"end"},{default:o(()=>[a(A,{onClick:x},{default:o(()=>[M(F(e(n)("common.cancel")),1)]),_:1}),a(A,{type:"primary",loading:e(N),onClick:C},{default:o(()=>[M(F(e(n)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:o(()=>[a(re,{class:"h-408px pr-20px"},{default:o(()=>[a(oe,{ref_key:"formRef",ref:U,model:l,rules:P,"label-placement":"left","label-width":100},{default:o(()=>[a(s,{label:e(n)("page.manage.user.username"),path:"username"},{default:o(()=>[a(r,{value:l.username,"onUpdate:value":t[0]||(t[0]=u=>l.username=u),placeholder:e(n)("page.manage.user.form.username"),disabled:d.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),a(s,{label:e(n)("page.manage.user.userGender"),path:"userGender"},{default:o(()=>[a(O,{value:l.userGender,"onUpdate:value":t[1]||(t[1]=u=>l.userGender=u)},{default:o(()=>[(w(!0),I(K,null,q(e(J),u=>(w(),T(m,{key:u.value,value:u.value,label:e(n)(u.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(s,{label:e(n)("page.manage.user.nickName"),path:"nickName"},{default:o(()=>[a(r,{value:l.nickName,"onUpdate:value":t[2]||(t[2]=u=>l.nickName=u),placeholder:e(n)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{label:e(n)("page.manage.user.userPhone"),path:"userPhone"},{default:o(()=>[a(r,{value:l.userPhone,"onUpdate:value":t[3]||(t[3]=u=>l.userPhone=u),placeholder:e(n)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{label:e(n)("page.manage.user.userEmail"),path:"email"},{default:o(()=>[a(r,{value:l.userEmail,"onUpdate:value":t[4]||(t[4]=u=>l.userEmail=u),placeholder:e(n)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{label:e(n)("page.manage.user.userStatus"),path:"status"},{default:o(()=>[a(O,{value:l.status,"onUpdate:value":t[5]||(t[5]=u=>l.status=u)},{default:o(()=>[(w(!0),I(K,null,q(e(Q),u=>(w(),T(m,{key:u.value,value:u.value,label:e(n)(u.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(s,{label:e(n)("page.manage.user.userRole"),path:"roles"},{default:o(()=>[a(_,{value:l.userRoles,"onUpdate:value":t[6]||(t[6]=u=>l.userRoles=u),multiple:"",options:c.value,placeholder:e(n)("page.manage.user.form.userRole")},null,8,["value","options","placeholder"])]),_:1},8,["label"]),d.operateType==="add"?(w(),T(s,{key:0,label:e(n)("page.manage.user.password"),path:"password"},{default:o(()=>[a(r,{value:l.password,"onUpdate:value":t[7]||(t[7]=u=>l.password=u),placeholder:e(n)("page.manage.user.form.password")},null,8,["value","placeholder"])]),_:1},8,["label"])):Se("",!0)]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),je=z({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(v,{emit:S}){const d=S,{formRef:b,validate:g,restoreValidation:U}=ne(),i=X(v,"model"),G=Y(()=>{const{patternRules:h}=le();return{userEmail:h.email,userPhone:h.phone}});async function k(){await U(),d("reset")}async function N(){await g(),d("search")}return(h,p)=>{const y=Z,l=ge,R=ee,P=Oe,c=L,E=$e,D=te,x=Fe,C=se,f=Be,t=Me,r=ae;return w(),T(r,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[a(t,null,{default:o(()=>[a(f,{title:e(n)("common.search"),name:"user-search"},{default:o(()=>[a(C,{ref_key:"formRef",ref:b,model:i.value,rules:G.value,"label-placement":"left","label-width":80},{default:o(()=>[a(x,{responsive:"screen","item-responsive":""},{default:o(()=>[a(l,{span:"24 s:12 m:6",label:e(n)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:o(()=>[a(y,{value:i.value.username,"onUpdate:value":p[0]||(p[0]=s=>i.value.username=s),placeholder:e(n)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{span:"24 s:12 m:6",label:e(n)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:o(()=>[a(R,{value:i.value.userGender,"onUpdate:value":p[1]||(p[1]=s=>i.value.userGender=s),placeholder:e(n)("page.manage.user.form.userGender"),options:e(W)(e(J)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(l,{span:"24 s:12 m:6",label:e(n)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:o(()=>[a(y,{value:i.value.nickName,"onUpdate:value":p[2]||(p[2]=s=>i.value.nickName=s),placeholder:e(n)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{span:"24 s:12 m:6",label:e(n)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:o(()=>[a(y,{value:i.value.userPhone,"onUpdate:value":p[3]||(p[3]=s=>i.value.userPhone=s),placeholder:e(n)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{span:"24 s:12 m:6",label:e(n)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:o(()=>[a(y,{value:i.value.userEmail,"onUpdate:value":p[4]||(p[4]=s=>i.value.userEmail=s),placeholder:e(n)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{span:"24 s:12 m:6",label:e(n)("page.manage.user.userStatus"),path:"userStatus",class:"pr-24px"},{default:o(()=>[a(R,{value:i.value.status,"onUpdate:value":p[5]||(p[5]=s=>i.value.status=s),placeholder:e(n)("page.manage.user.form.userStatus"),options:e(W)(e(Q)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(l,{span:"24 m:12",class:"pr-24px"},{default:o(()=>[a(D,{class:"w-full",justify:"end"},{default:o(()=>[a(c,{onClick:k},{icon:o(()=>[a(P,{class:"text-icon"})]),default:o(()=>[M(" "+F(e(n)("common.reset")),1)]),_:1}),a(c,{type:"primary",ghost:"",onClick:N},{icon:o(()=>[a(E,{class:"text-icon"})]),default:o(()=>[M(" "+F(e(n)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Ie={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Ce(v)}const He=z({name:"manage_user",__name:"index",setup(v){const S=De(),{columns:d,columnChecks:b,data:g,getData:U,getDataByPage:i,loading:G,mobilePagination:k,searchParams:N,resetSearchParams:h}=fe({apiFn:be,showTotal:!0,apiParams:{current:1,size:10,status:null,username:null,userGender:null,nickName:null,userPhone:null,userEmail:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:n("common.index"),align:"center",width:64},{key:"username",title:n("page.manage.user.username"),align:"center",minWidth:100},{key:"userGender",title:n("page.manage.user.userGender"),align:"center",width:100,render:t=>{if(t.userGender===null)return null;const r={1:"primary",2:"error"},s=n(he[t.userGender]);return a(H,{type:r[t.userGender]},B(s)?s:{default:()=>[s]})}},{key:"nickName",title:n("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:n("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:n("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"status",title:n("page.manage.user.userStatus"),align:"center",width:100,render:t=>{if(t.status===null)return null;const r={1:"success",2:"warning"},s=n(ye[t.status]);return a(H,{type:r[t.status]},B(s)?s:{default:()=>[s]})}},{key:"operate",title:n("common.operate"),align:"center",width:130,render:t=>{let r;return a("div",{class:"flex-center gap-8px"},[a(L,{type:"primary",ghost:!0,size:"small",onClick:()=>f(t.id)},B(r=n("common.edit"))?r:{default:()=>[r]}),a(we,{onPositiveClick:()=>C(t.id)},{default:()=>n("common.confirmDelete"),trigger:()=>{let s;return a(L,{type:"error",ghost:!0,size:"small"},B(s=n("common.delete"))?s:{default:()=>[s]})}})])}}]}),{drawerVisible:p,operateType:y,editingData:l,handleAdd:R,handleEdit:P,checkedRowKeys:c,onBatchDeleted:E,onDeleted:D}=ve(g,U);async function x(){const t=c.value.map(s=>Number.parseInt(s,10)),{error:r}=await V(t);r||E()}async function C(t){const r=[t],{error:s}=await V(r);s||D()}function f(t){P(t)}return(t,r)=>{const s=ke,m=Ne,O=ae;return w(),I("div",Ie,[a(je,{model:e(N),"onUpdate:model":r[0]||(r[0]=_=>$(N)?N.value=_:null),onReset:e(h),onSearch:e(i)},null,8,["model","onReset","onSearch"]),a(O,{title:e(n)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[a(s,{columns:e(b),"onUpdate:columns":r[1]||(r[1]=_=>$(b)?b.value=_:null),"disabled-delete":e(c).length===0,loading:e(G),onAdd:e(R),onDelete:x,onRefresh:e(U)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:o(()=>[a(m,{"checked-row-keys":e(c),"onUpdate:checkedRowKeys":r[2]||(r[2]=_=>$(c)?c.value=_:null),columns:e(d),data:e(g),size:"small","flex-height":!e(S).isMobile,"scroll-x":962,loading:e(G),remote:"","row-key":_=>_.id,pagination:e(k),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Le,{visible:e(p),"onUpdate:visible":r[3]||(r[3]=_=>$(p)?p.value=_:null),"operate-type":e(y),"row-data":e(l),onSubmitted:e(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{He as default};
